var locale = '<%= I18n.locale %>';
// get data from controller
var imageData = '<%= raw @image_data %>';
console.log("IN display_theme: @image_data = " + imageData );
var valuesQty = '<%= @image_data[:values_qty] %>';
console.log("IN display_theme: valuesQty = " + valuesQty );
$('.left_controls span.total_values h2.total').html(valuesQty);

// show theme
var selectedTheme = '<%= @image_data[:theme] %>';

if( selectedTheme == "Выберите тему для оценки" || selectedTheme == "Select theme to give your opinion" || selectedTheme == ""){
    $('.img-left-side').css({"display": "none"});
    $('.img-right-side').css({"display": "none"});
    $('.image_diag').css({"display": "none"});
}else{
    $('.img-left-side').css({"display": "block"});
    $('.img-right-side').css({"display": "block"});
    $('.image_diag').css({"display": "block"});
}

$('.image_display h2.up-theme').html(selectedTheme);

//restore button
$('.select_theme').html("<%= j render 'button_theme_select' -%>");

// get data from controller
var imageCurrentIndex = '<%= @image_data[:index] %>';
//var firstThemeImagesName = JSON.parse(firstThemeImages)["name"];
var oneImageName = '<%= @image_data[:name] %>';
var oneImageFile = '<%= @image_data[:file] %>';
var oneImageId = '<%= @image_data[:image_id] %>';
var themeImagesSize = '<%= @image_data[:images_arr_size] %>';
var selectedThemeId = '<%= @image_data[:theme_id] %>';


// show name of image
//var nameImage = selectedImage.slice(0,-4) ;  // put away . file .jpg
$('.image_display figcaption').html(oneImageName);

// show image
var pathImage = "assets/pictures/" + oneImageFile;
// $('.img-center').html('<img alt="Selected Image" src="'+ pathImage + '"/>');
$(".img-center").attr({title: oneImageName });
$(".img-center img").attr({alt: oneImageName, src: pathImage, title: oneImageName });

// AJAX call to next image list
$('.img-right-side').click(function(event) {
  event.stopImmediatePropagation(); // would stop the event from bubbling to parent elements,
  $.ajax({
    type: "get",
    url: "api/next_image",
    data: { index: imageCurrentIndex,
      theme_id: selectedThemeId,
      length: themeImagesSize,
      locale: locale
      },
    dataType: 'json'
  }).done(function (data_return) {
    console.log("success1c:  " + data_return.notice );
    imageCurrentIndex = data_return.new_image_index;
    oneImageName = data_return.name;
    oneImageFile = data_return.file;
    oneImageId = data_return.image_id;
    $('.image_display figcaption').hide().html(oneImageName).fadeIn(600);
    var pathImage = "assets/pictures/" + oneImageFile;
    $(".img-center").attr({title: oneImageName });
    $(".img-center img").fadeOut(500, function(){
        $(this).attr({alt: oneImageName, src: pathImage, title: oneImageName }).fadeIn(600);
    });

    //var userValuedFlag = data_return.user_valued;
    //if(userValuedFlag  == 1){
    //  $('.left_controls span.common_value').css({"display": "block"});
     // var imageValue = data_return.value;
     // $('.image .image_display .image_user_value').append().html(imageValue).css({"display": "block"});
     // $('.image .image_display .image_diag').css({"display": "none"});

    //  var imageCommonValue = data_return.common_ave_value;
     // $('.left_controls span.common_value h2.common').append().html(imageCommonValue);

      //// $('.image .image_display .image_user_value').css({"display": "block"});
    //}else{
     // $('.left_controls span.common_value').css({"display": "none"});
    //  $('.image .image_display .image_user_value').css({"display": "none"});
    //  $('.image .image_display .image_diag').css({"display": "block"});
   // }

  })
      .fail(function (data_return) {
        console.log("error: data_return = " + data_return);
      });
});

// AJAX call to previous image list
$('.img-left-side').click(function(event) {
  event.stopImmediatePropagation(); // would stop the event from bubbling to parent elements,
  $.ajax({
    type: "get",
    url: "api/prev_image",
    data: { index: imageCurrentIndex,
      theme_id: selectedThemeId,
      length: themeImagesSize,
      locale: locale
    },
    dataType: 'json'
  }).done(function (data_return) {
    console.log("success1c:  " + data_return.notice );
    imageCurrentIndex = data_return.new_image_index;
    oneImageName = data_return.name;
    oneImageFile = data_return.file;
    oneImageId = data_return.image_id;

    $('.image_display figcaption').hide().html(oneImageName).fadeIn(600);
    var pathImage = "assets/pictures/" + oneImageFile;
    $(".img-center").attr({title: oneImageName });
    $(".img-center img").fadeOut(500, function(){
        $(this).attr({alt: oneImageName, src: pathImage, title: oneImageName }).fadeIn(600);
    });

   // var userValuedFlag = data_return.user_valued;
   // if(userValuedFlag  == 1){
     // $('.left_controls span.common_value').css({"display": "block"});
    //  var imageValue = data_return.value;
    //  $('.image .image_display .image_user_value').append().html(imageValue);
    //  $('.image .image_display .image_diag').css({"display": "none"});
    //  var imageCommonValue = data_return.common_ave_value;
     // $('.left_controls span.common_value h2.common').append().html(imageCommonValue);
    //  $('.image .image_display .image_user_value').css({"display": "block"});
    //}else{
    //  $('.left_controls span.common_value').css({"display": "none"});
    //  console.log("7 IN ELSE: userValuedImage == false? == " + userValuedFlag);
    //  $('.image .image_display .image_user_value').css({"display": "none"});
    //  $('.image .image_display .image_diag').css({"display": "block"});

    //}
  })
      .fail(function (data_return) {
        console.log("error: data_return = " + data_return);
      });

});
